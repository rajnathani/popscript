var popscript = {
    basic: {
        STYLE: {
            CLASS: {
                box: 'simple-box',
                cover: 'curtain',
                cross: 'cross'
            }
        },
        ANIMATION: {
            IN: {
                box: 'zap-in cubic-bezier(.73,.75,.72,1.77)',
                cover: 'fade-in',
                duration: 300
            },
            OUT: {
                box: 'zap-out cubic-bezier(.73,.75,.72,1.77)',
                cover: 'fade-out',
                duration: 200
            }
        },
        POSITION: {
            x: 'auto',
            y: 'auto'
        },

        cover: 'yes',
        cross: 'yes',
        cross_content: 'x',
        esc: 'ye',
        full_draggable: 'yes'
    },

    success: {
        STYLE: {
            CLASS: {
                box: 'success'
            }
        },
        ANIMATION: {
            IN: {
                box: 'drop'
            },
            OUT: {
                box: 'undrop'
            }
        },
        POSITION: {
            y: 'top'
        },

        cross: 'no',
        full_draggable: 'naaaaoh',
        click_me_out: 'yes, tis is convenient'
    },

    error: {
        STYLE: {
            CLASS: {
                box: 'error'
            }
        },
        ANIMATION: {
            IN: {
                box: 'short-arrive-left, fade-in'
            },
            OUT: {
                box: 'fade-out'
            }
        },
        POSITION: {
            x: '!10',
            y: '10'
        }
    },

    dropdown: {
        STYLE: {
            CLASS: {
                box: 'dropdown'
            }
        },
        ANIMATION: {
            IN: {
                duration: 90
            },
            OUT: {
                box: ''
            }
        },
        POSITION: {
            z: '-1'
        },

        cross: 'no',
        cover: 'no',
        full_draggable: 'no'
    },

    context_menu: {
        STYLE: {
            CLASS: {
                box: 'context-menu'
            }
        },
        ANIMATION: {
            IN: {
                box: ''
            },
            OUT: {
                box: 'fade-out',
                duration: 120
            }
        },
        POSITION: {
            fixed: 'no',
            z: '-1'
        },

        cover: 'no',
        cross: 'no',
        full_draggable: 'no'
    },

    tooltip: {
        STYLE: {
            CLASS: {
                box: 'popscript-tooltip'
            }
        },
        ANIMATION: {
            OUT: {
                box: 'fade-out'
            }
        },
        POSITION: {
            z: '-1'
        },

        click_me_out: 'yeh',
        cross: 'no',
        cover: 'no',
        blur: 'no',
        esc: 'yes',
        full_draggable: 'no'
    },

    tip_left: {
        STYLE: {
            CLASS: {
                box: 'popscript-tooltip left'
            }
        },
        ANIMATION: {
            IN: {
                box: 'short-arrive-left, fade-in'
            }
        }
    },
    tip_right: {
        STYLE: {
            CLASS: {
                box: 'popscript-tooltip right'
            }
        },
        ANIMATION: {
            IN: {
                box: 'short-arrive-right, fade-in'
            }
        }
    },
    tip_up: {
        STYLE: {
            CLASS: {
                box: 'popscript-tooltip up'
            }
        },
        ANIMATION: {
            IN: {
                box: 'short-arrive-up, fade-in'
            }
        }
    },
    tip_down: {
        STYLE: {
            CLASS: {
                box: 'popscript-tooltip down'
            }
        },
        ANIMATION: {
            IN: {
                box: 'short-arrive-down, fade-in'
            }
        }
    },

    roller: {
        STYLE: {
            CLASS: {
                box: 'roller'
            }
        },
        ANIMATION: {
            IN: {
                box: 'newspaper',
                duration: 800
            }
        },
        POSITION: {
            x: 'auto',
            y: '8%',
            roller: 'yes'
        }
    }
};

var popscript_flags = {
    'alert error on error': false,  // alerts the error (alert)
    'throw error on error': true,   // throws the error (throw)
    'Z': 1000                       // base z-index for all pops
};

function Pop(e,o){this.changeClass(e),this.inline_popscript={},this.inline(o)}function pop(e,o){var t,n,i,r,s,a,p,c,l,d;e instanceof Array?(n=e,t=o):t=e;for(var u,f=1+Number(Boolean(n));f<arguments.length;f++)u=arguments[f],"string"==typeof u?i=u:"object"==typeof u&&(r=u);i=i?"basic "+i:"basic";var m,P,v,_;if(_=!1,n){var h=n[0];P=n[1]instanceof Array?n[1]:[n[1]],v=n[2]instanceof Array?n[2]:void 0===n[2]?[]:[n[2]],_=n[3]}if(n&&_||(s=PS.increasePop(),m=new Pop(i,r),m.pop_id=s,m.binder=Boolean(n),PS.map[s]=m),n)if(_)if(s=_,m=PS.map[s],"hide"===m.scan("out")){var S,y=[];for(f=0;f<P.length;f++)g=P[f],-1!==v.indexOf(g)?y.push(g):PS.event.add(h,g,function(){popShow(s)});for(f=0;f<v.length;f++)b=v[f],-1===P.indexOf(b)&&PS.event.add(h,b,function(){popHide(s)});for(f=0;f<y.length;f++)S=y[f],PS.event.add(h,S,function(){popToggle(s)})}else for(f=0;f<v.length;f++)b=v[f],PS.event.add(h,b,PS.binder_done);else{var g,b,x;for(null===h.getAttribute("data-pop-bind-id")?(x=++PS.pop_bind_num,h.setAttribute("data-pop-bind-id",String(x)),PS.bind_map[x]={},PS.bind_map[x].ev2pn={}):x=parseInt(h.getAttribute("data-pop-bind-id")),PS.rev_bind_map[s]=x,PS.bind_map[x][s]={el:h,content:t,pop_class:i,inline_popscript:r,in_events:P,out_events:v},f=0;f<P.length;f++)g=P[f],PS.bind_map[x].ev2pn[g]=s,PS.event.add(h,g,PS.binder_wait)}if(!n||_){if(d=PS.initiatePop(t,s),a=d[0],p=d[1],c=d[2],l=d[3],m.scan("beforePopIn")&&m.scan("beforePopIn")(!0)===!1)return!1;PS.constructPop(m,a,p,c,l)}return s}function popOut(e,o){var t,n,i;if(e&&("string"==typeof e?n=e:"number"==typeof e?t=e:"object"==typeof e?this!==window&&(i=e,t=PopScript.helper.event.call(this,i)):PS.popError(51,"Invalid argument type: "+typeof e)),o&&("string"==typeof o?n=o:"number"==typeof o?t=o:PS.popError(51,"Invalid argument type: "+typeof o)),void 0!==t||(t=PS.highestConditionPopId(),-1!==t)){var r=PS.map[t];if(r&&!r.scan("hidden")&&!r.destroyed&&("close"===r.scan("out")&&(r.destroyed=!0),n=void 0===n?r.scan("out"):n,n=PS.convert.hideOrClose(n))){var s,a,p;if(s=PS.boxNode(t),a=PS.coverNode(t),p=PS.rollerNode(t),r.scan("beforePopOut")&&r.scan("beforePopOut").call(s,n)===!1)return!1;var c={};c[s.id]=r.scan("animation_out_box"),a?c[a.id]=r.scan("animation_out_cover"):a.parentNode.removeChild(a);var l,d,u;if(d=r.scan("animation_out_duration"),l=r.scan("animation_out_true_duration"),u=void 0===l?0:l.global?Math.max(d,l.len):l,r.binder&&"close"===n){for(var f=PS.rev_bind_map[t],m=PS.bind_map[f][t],P=0;P<m.out_events.length;P++)PS.event.remove(m.el,m.out_events[P],PS.binder_done);delete PS.bind_map[f][t],pop([m.el,m.in_events,m.out_events],m.content,m.pop_class,m.inline_popscript)}return setTimeout(function(){for(var e=r.scan("afterPopOut"),o=0;o<e.length;o++)e[o](t,n);if("close"===n){for(var i=r.scan("timeouts"),s=r.scan("intervals"),o=0;o<i.length;o++)clearInterval(i[o]);for(o=0;o<s.length;o++)clearInterval(s[o]);r.scan("position_roller")||p.parentNode.removeChild(p),delete PS.map[t]}else r.compiled.hidden=!0,r.scan("position_roller")||PS.css_class.add(p,"popscript-display-none")},u),PS.animateOut(d,c,r,n),r.scan("position_roller")&&1===PS.numRollersLeft()&&PS.cover_fix.unfix(),!1}}}function popClose(e){"object"==typeof e&&popOut.call(this,e,"close"),popOut(e,"close")}function popHide(e){"object"==typeof e&&popOut.call(this,e,"hide"),popOut(e,"hide")}function popShow(e){var o=PS.map[e];if(!o||!o.compiled.hidden)return!1;if(o.scan("beforePopIn")&&o.scan("beforePopIn")(!1)===!1)return!1;var t,n,i;t=PS.boxNode(e),n=PS.coverNode(e),i=PS.rollerNode(e),PS.animateIn(o,t,n),PS.css_class.remove(n,"popscript-display-none"),o.scan("position_roller")?(PS.css_class.remove(i,"popscript-display-none"),PS.cover_fix.fix()):PS.css_class.remove(t,"popscript-display-none"),o.compiled.hidden=!1,PS.blurNoPropagate(o),PS.pos.check(e,t,n,i)}function popToggle(e){var o=PS.map[e];return o?(o.compiled.hidden?popShow(e):popHide(e),void 0):!1}function initiatePopScript(){PS.compile(popscript),PS.event.add(document,"keydown",PS.escPopOut),PS.event.add(document,"click",PS.blurPopOut),PS.event.add(document,"contextmenu",PS.blurPopOut),PS.event.add(window,"resize",PS.pos.checkAll),PS.event.add(window,"scroll",PS.pos.checkAll)}var PS={version:1,num_pops_created:0,map:{},bind_map:{},rev_bind_map:{},pop_bind_num:0,compiled_popscript:{},increasePop:function(){return++this.num_pops_created},escPopOut:function(e){if(e=e||window.event,!PS.findAncestorPop(e.srcElement||e.target)){var o=e?e.keyCode:window.event.keyCode;if(27===o){var t=PS.highestConditionPopId(function(e){var o=PS.map[e];return o&&o.scan("esc")});if(-1!==t){var n=PS.map[t];popOut(t,n.scan("out"))}}}},blurPopOut:function(e){if(e=e||window.event,!PS.findAncestorPop(e.srcElement||e.target)){var o=PS.highestConditionPopId(function(e){var o=PS.map[e];return o&&o.scan("blur")});if(-1!==o){var t=PS.map[o];popOut(o,t.scan("out"))}}},highestConditionPopId:function(e){e||(e=function(){return!0});for(var o,t,n=PS.num_pops_created;0!==n;){if(o=document.getElementById("popscript-box-"+n),t=PS.map[n],t&&o&&!t.compiled.hidden&&e(n))return n;n--}return-1},animationPossible:function(){var e=!1,o="animation",t="",n="Webkit Moz O ms Khtml".split(" "),i="";if(void 0!==document.body.style.animationName&&(e=!0),e===!1)for(var r=0;r<n.length;r++)if(void 0!==document.body.style[n[r]+"AnimationName"]){i=n[r],o=i+"Animation",t="-"+i.toLowerCase()+"-",e=!0;break}return e},getDocHeight:function(){var e=PS.dims.node(document.getElementsByTagName("html")[0],!0);return e.h},convert:{bool:function(e){if("string"==typeof e){var o=e[0].toLowerCase();"y"===o?e=!0:"n"===o&&(e=!1)}else"number"==typeof e&&(e=Boolean(e));return e!==!0&&e!==!1&&PS.popError(45,"'"+e+"'"+" is not a valid PopScript boolean."),e},ani:function(e){var o,t,n,i,r,s,a,p=e.replace(/(\([^\)]*\))/g,function(e){return e.replace(/,/g,"@")}),c=p.split(/ *, */);s="";for(var l=0;l<c.length;l++)t=PS.animationDurationIteration(c[l]),n=t[0],i=t[1],r=n*i,n?(s+=n+"ms",(!o||r>o)&&(o=r)):(s+="$g",a=!0),l+1!==c.length&&(s+=",");var d,u,f,m,P=this[1],v=this[0],_=v.match(/animation_((in)|(out))_/);return d="animation_"+_[1]+"_true_duration",u=P[d],u?(f=void 0===o?u.len:Math.max(u.len,o),m=u.global||a):(f=void 0===o?0:Math.max(0,o),m=a),P[d]={len:f,global:m},[p.replace(/@/g,","),s,o]},_position_macros:{left:!0,top:!0,right:!1,bottom:!1,auto:null},boxPosition:function(e){if("number"==typeof e)return[Math.abs(e),!0,!1];var o=e.toLowerCase().split(/ *\+ */),t=[!1,!1,!1],n=this[0]+"_scrolled",i=this[1][n];this[1][n]=i||Boolean(-1!==o.indexOf("scrolled"));var r=this[0]+"_scroll",s=this[1][r];if(this[1][r]=s||Boolean(-1!==o.indexOf("scroll")),t[0]=o[0],-1===["auto","left","right","top","bottom"].indexOf(t[0])){t[2]="%"===t[0][t[0].length-1];var a=t[1]?t[0].match(/(!?) *(\-?[\d]+)%/):t[0].match(/(!?) *(\-?[\d]+)/);t[1]=!Boolean(a[1]),t[0]=parseInt(a[2])/(t[2]?100:1)}else"auto"!==t[0]&&(t[1]=PS.convert._position_macros[t[0]],t[0]=0);return t},positionCheck:function(e){if(!e)return!1;for(var o,t,n,i=e.replace(/^(\s*)/,"").replace(/(\s*)$/,"").split(/ *, */),r=[],s=[],a=0;a<i.length;a++)if(o=i[a],n=o.length-1,"*"===o[n]){if(t=parseInt(o.substr(0,n)),isNaN(t))return PS.popError(23,"Invalid Position Check Number: "+o);s.push(t)}else{if(t=parseInt(o),isNaN(t))return PS.popError(23,"Invalid Position Check Number: "+o);r.push(t)}return[r,s]},loff:function(e){return"function"==typeof e?[e]:e},n:function(e){return e},z:function(e){if("number"==typeof e)return function(){return e};var o=e.match(/\s*(\+|\-)?\s*(\d*)/);if(o){var t=parseInt(o[2]);return o[1]?"-"===o[1]?function(){return popscript_flags.Z-t}:function(){return popscript_flags.Z+t}:function(){return t}}},hideOrClose:function(e){return"close"!==e&&"hide"!==e?PS.popError(92,'Invalid out value (must be either "hide" or "close"): '+e):e}},defaults:{position_x:["auto",!1,!1],position_y:["auto",!1,!1],position_z:function(){return popscript_flags.Z},position_check:[[20,333],[1e3]],positioncheck:null,position_fixed:!0,position_x_scroll:!1,position_x_scrolled:!1,position_y_scroll:!1,position_y_scrolled:!1,blur:!0,esc:!0,out:"hide",cover:!0,cross:!0,full_draggable:!1,position_roller:!1,cross_content:"x",animation_in_duration:300,animation_out_duration:300,afterpopout:[],transition_duration:500},compile:function(e){for(var o in e)if(e.hasOwnProperty(o)){var t;PS.compiled_popscript[o]||(PS.compiled_popscript[o]={}),t=this.compilePopClass(e[o]);for(var n in t)t.hasOwnProperty(n)&&(PS.compiled_popscript[o][n]=t[n])}},compilePopClass:function(e,o){o=o?o:{};for(var t in e)e.hasOwnProperty(t)&&("object"!=typeof e[t]||e[t]instanceof Array?this.registerPopProperty(o,t,e[t]):this.compileScope([t],e[t],o,e));return o},compileScope:function(e,o,t,n){if("object"!=typeof o)return this.popError(26,"Scope '"+e.join(">")+"' has to be an object"),null;for(var i in o)o.hasOwnProperty(i)&&("object"==typeof o[i]?this.compileScope(this.helper.cloneAndPushArray(e,i),o[i],t,n):this.registerPopProperty(t,i,o[i],e))},registerPopProperty:function(e,o,t,n){var i=n?this.compiledScopeName(n)+o.toLowerCase():o.toLowerCase();this.all_properties[i]?e[i]=PS.all_properties[i].call([i,e],t):this.popError(29,'Unknown pop property name: "'+o+'"'+(n?" within scope: "+n.join(">"):""))},compiledScopeName:function(e){for(var o="",t=0;t<e.length;t++)o+=e[t].toLowerCase()+"_";return o},hasStandaloneProperty:function(e,o){o=o.toLowerCase();for(var t in e)if(e.hasOwnProperty(t)&&t.toLowerCase()===o)return!0;return!1},boxNode:function(e){return document.getElementById("popscript-box-"+e)},coverNode:function(e){return document.getElementById("popscript-cover-"+e)},rollerNode:function(e){return document.getElementById("popscript-roller-"+e)},crossNode:function(e){return document.getElementById("popscript-cross-"+e)},drag:{box_node:null,pop_id:-1,roller_node:null,pop_position_fixed:null,diff:[],start:function(e){PS.drag.no_user_select();var o=PS.findAncestorPop(this);if(o){PS.event.add(document,"mousemove",PS.drag.during),PS.drag.box_node=o,PS.drag.pop_id=parseInt(o.getAttribute("data-pop-id")),PS.drag.roller_node=document.getElementById("popscript-roller-"+PS.drag.pop_id),PS.drag.pop_position_roller=PS.map[PS.drag.pop_id].scan("position_roller"),PS.drag.pop_position_fixed=PS.map[PS.drag.pop_id].scan("position_fixed")&&!PS.drag.pop_position_roller;var t=PS.pos.mouse(e?e:window.event,PS.drag.pop_position_roller?PS.drag.roller_node:void 0),n={x:0,y:0};PS.drag.pop_position_fixed&&(n=PS.pos.scrolled()),PS.drag.diff[0]=t[0]-n.x-PS.pos.offset(o,PS.drag.roller_node).left,PS.drag.diff[1]=t[1]-n.y-PS.pos.offset(o,PS.drag.roller_node).top}},during:function(e){if(!PS.drag.box_node)return null;var o=PS.pos.mouse(e?e:window.event,PS.drag.pop_position_roller?PS.drag.roller_node:void 0),t={x:0,y:0};PS.drag.pop_position_fixed&&(t=PS.pos.scrolled());var n=o[0]-t.x-PS.drag.diff[0],i=o[1]-t.y-PS.drag.diff[1];PS.drag.box_node.style.left=n+"px",PS.drag.box_node.style.top=i+"px",PS.map[PS.drag.pop_id].compiled.moved=!0},done:function(){PS.event.remove(document,"mousemove",PS.drag.during),PS.drag.no_no_user_select(),PS.drag.box_node=null,PS.drag.pop_id=-1},user_select:{"-webkit-":"","-moz-":"","-ms-":"","":""},no_user_select:function(){for(var e in this.user_select)this.user_select.hasOwnProperty(e)&&(this.user_select[e]=document.body.style[e+"user-select"],document.body.style[e+"user-select"]="none")},no_no_user_select:function(){for(var e in this.user_select)this.user_select.hasOwnProperty(e)&&document.body.style[e+"user-select"]&&(document.body.style[e+"user-select"]=this.user_select[e])}},findAncestorPop:function(e){for(var o=e;o;){if(PS.css_class.has(o,"popscript-box"))return o;o=o.parentNode}return null},pos:{offset:function(e,o){if("fixed"===e.style.position)return e.getBoundingClientRect();var t=0,n=0;if(e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop;while((e=e.offsetParent)&&e!==o);return{left:t,top:n}},mouse:function(e,o){var t=0,n=0;if(!e)var e=window.event;if(e.pageX?(t=e.pageX,n=e.pageY):(t=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),o&&o!==window){var i=PS.pos.offset(o),r=PS.pos.scrolled();return[t-i.left+r.x,n-i.top+r.y]}return[t,n]},scrolled:function(e){return e&&e!==window?{y:e.scrollTop,x:e.scrollLeft}:{y:Math.max(window.scrollY,document.documentElement.scrollTop,document.body.scrollTop),x:Math.max(window.scrollX,document.documentElement.scrollLeft,document.body.scrollLeft)}},check:function(e,o,t,n){var i,r,s,a;if(o?(r=o,s=t,a=n,i=PS.dims.node(o.cloneNode(!0))):(r=PS.boxNode(e),s=PS.coverNode(e),a=PS.rollerNode(e),i=PS.dims.node(r,!0)),i){var p=PS.map[e];if(p.scan("moved")||p.scan("hidden"))return!1;var c=PS.dims.window(),l=PS.pos.scrolled();p.scan("cover")&&(s.style.height=PS.getDocHeight()+"px"),p.scan("position_roller")&&(a.style.height=PS.getDocHeight()+"px",a.style.maxHeight=PS.dims.window().height+"px",a.style.top=l.y+"px",a.style.left=l.x+"px");var d,u,f,m,P,v,_;if(P=p.scan("cover"),m=p.scan("position_roller"),p.scan("nearelement")){var h,S;h=p.scan("nearelement")[0],S=p.scan("nearelement")[1];var y=PS.nearElement(h,S,i);p.compiled.position_fixed=PS.pos.isFixed(h),u=PS.convert.boxPosition.call(["position_x_scrolled",p.compiled],y[0]),d=PS.convert.boxPosition.call(["position_y_scrolled",p.compiled],y[1])}else u=p.scan("position_x"),d=p.scan("position_y");f=p.scan("position_fixed"),r.style.position=!m&&f?"fixed":"absolute",p.scrolled_y=void 0!==p.scrolled_y?p.scrolled_y:!m&&p.scan("position_y_scrolled")?l.y:0,p.scrolled_x=void 0!==p.scrolled_x?p.scrolled_x:!m&&p.scan("position_x_scrolled")?l.x:0,_=p.scrolled_y+(!m&&p.scan("position_y_scroll")?l.y:0),v=p.scrolled_x+(!m&&p.scan("position_x_scroll")?l.x:0),r.style.top="auto",r.style.right="auto",r.style.bottom="auto",r.style.left="auto";var g=c.width-i.w+v,b=c.height-i.h+_;r.style.top="auto"!==d[0]?d[1]?PS.dims.auto(d[0],c.height,i.h,_,d[2])+"px":b-PS.dims.auto(d[0],c.height,i.h,-_,d[2])+"px":PS.dims.auto(d[0],c.height,i.h,_,d[2])+"px",r.style.left="auto"!==u[0]?u[1]?PS.dims.auto(u[0],c.width,i.w,v,u[2])+"px":g-PS.dims.auto(u[0],c.width,i.w,-v,u[2])+"px":PS.dims.auto(u[0],c.width,i.w,v,u[2])+"px"}},isFixed:function(e){return e.style&&"fixed"===e.style.position||!(e.style&&e.style.position)&&e.tagName&&window.getComputedStyle(e,null)&&"fixed"===window.getComputedStyle(e,null).getPropertyValue("position")||e.parentNode&&PS.pos.isFixed(e.parentNode)},checkAll:function(){for(var e in PS.map)PS.map.hasOwnProperty(e)&&PS.pos.check(e)}},dims:{node:function(e,o){if(e){if(!o){var t={};e.style.visibility="hidden",e.id="popscript-check-popup-dimensions",document.body.appendChild(e);var n=document.getElementById("popscript-check-popup-dimensions");return t.h=n.offsetHeight,t.w=n.offsetWidth,e.style.visibility="visible",document.body.removeChild(n),t}return{h:e.offsetHeight,w:e.offsetWidth}}},auto:function(e,o,t,n,i){return"auto"===e?t>=o?n:parseInt((o-t)/2)+n:i?n+parseFloat(o)*e:n+e},window:function(){var e={};return"number"==typeof window.innerWidth?(e.width=window.innerWidth,e.height=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(e.width=document.documentElement.clientWidth,e.height=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(e.width=document.body.clientWidth,e.height=document.body.clientHeight),e},cover:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.overflow="auto",e.style.width="100%",e.style.top="0",e.style.left="0",e.style.right="0",e}},cover_fix:{orig_body_overflow:void 0,count:0,fix:function(){var e=PS.cover_fix;e.count++||(e.orig_body_overflow=document.body.style.overflow?document.body.style.overflow:"visible",document.body.style.overflow="hidden")},unfix:function(){var e=PS.cover_fix;--e.count||(document.body.style.overflow=e.orig_body_overflow)}},event:{GUID:1,add:function(e,o,t){if(e.addEventListener)e.addEventListener(o,t,!1);else{t.$$guid||(t.$$guid=PS.event.GUID++),e.events||(e.events={});var n=e.events[o];n||(n=e.events[o]={},e["on"+o]&&(n[0]=e["on"+o])),n[t.$$guid]=t,e["on"+o]=this.handle}},remove:function(e,o,t){e.removeEventListener?e.removeEventListener(o,t,!1):e.events&&e.events[o]&&delete e.events[o][t.$$guid]},handle:function(e){var o=!0;e=e||PS.fix(((this.ownerDocument||this.document||this).parentWindow||window).event);var t=this.events[e.type];for(var n in t)this.$$handleEvent=t[n],this.$$handleEvent(e)===!1&&(o=!1);return o},fix:function(e){return e.preventDefault=PS.fix_preventDefault,e.stopPropagation=PS.fix_stopPropagation,e},fix_preventDefault:function(){this.returnValue=!1},fix_stopPropagation:function(){this.cancelBubble=!0}},checkValidPopClasses:function(e){for(var o=PS.helper.trimString(e).split(/[\s]+/),t=0;t<o.length;t++)if(!this.compiled_popscript[o[t]])return this.popError(3,"Inexistent Pop Class: '"+o[t]+"'");return o},popError:function(e,o){var t="PopScript Error "+e+": "+o;if(console.error(t),popscript_flags["alert error on error"]&&alert(t),popscript_flags["throw error on error"])throw t;return!1},animateIn:function(e,o,t){var n=e.scan("animation_in_duration");if(e.scan("cover")){var i=e.scan("animation_in_cover");i&&PS.addAnimation(t,i,n)}var r=e.scan("animation_in_box");r&&PS.addAnimation(o,r,n)},animateOut:function(e,o,t,n){for(var i in o)if(o.hasOwnProperty(i)){var r=o[i];if(r){var s=document.getElementById(i);this.addAnimation(s,r,e,n)}}},animationDurationIteration:function(e){var o=e.match(/(.?\d+)(m?s)/),t=e.match(/ +(\d+) +/);return[o?"s"===o[2]?1e3*parseFloat(o[1]):parseFloat(o[1]):void 0,t?parseInt(t[1]):1]},addAnimation:function(e,o,t,n){var i=function(){n&&("popscript-roller"===e.parentNode.className?"close"===n?e.parentNode.parentNode.removeChild(e.parentNode):PS.css_class.add(e.parentNode,"popscript-display-none"):"close"===n?e.parentNode.removeChild(e):PS.css_class.add(e,"popscript-display-none"))};if(PS.animationPossible()){var r,s,a,p;r=o[0],p=o[1],p=p.replace(/\$g/g,t+"ms"),e.style.animation=r,e.style.webkitAnimation=r,e.style.animationDuration=p,e.style.webkitAnimationDuration=p,n&&(s=o[2],a=void 0===s?t:s,setTimeout(i,a))}else i()},helper:{cloneSingleLevel:function(e){for(var o=[],t=0;t<e.length;t++)o.push(e[t]);return o},cloneAndPushArray:function(e,o){var t=this.cloneSingleLevel(e);return t.push(o),t},sliceArray:function(e,o,t){for(var n=[];t>o;o++)n.push(e[o]);return n},trimString:function(e){return e.replace(/^\s+|\s+$/g,"")},event:function(e){if(this===(e.srcElement||e.target)){var o=PS.findAncestorPop(this);if(o)return parseInt(o.getAttribute("data-pop-id"))}},changeTransition:function(e,o,t){var n="number"==typeof t,i=PS.boxNode(o),r=PS.coverNode(o);if(n){i.style.animation="",i.style.webkitAnimation="",r.style.animation="",r.style.webkitAnimation="";var s=i.style.transition,a=i.style.webkitTransition,p=r.style.transition,c=r.style.webkitTransition;i.style.transition=t+"ms all",i.style.webkitTransition=t+"ms all",r.style.transition=t+"ms all",r.style.webkitTransition=t+"ms all",setTimeout(function(){i.style.transition=s,i.style.webkitTransition=a,r.style.transition=p,r.style.webkitTransition=c},t+100)}PS.constructPop(e,i,r,PS.rollerNode(o),PS.crossNode(o),n)}},css_class:{nodes:function(e,o){o||(o=document);var t=[];if(o.getElementsByClassName)t=o.getElementsByClassName(e);else if(o.querySelectorAll)t=o.querySelectorAll(e);else for(var n=o.getElementsByTagName("*"),i=0;i<n.length;i++)n[i].className&&this.has(n[i],e)&&t.push(n[i]);return o!==document&&this.has(o,e)&&(t=PS.helper.cloneSingleLevel(t),t.push(o)),t},has:function(e,o){return e.className?-1!==e.className.split(/ +/).indexOf(o):!1},add:function(e,o){this.has(e,o)||(e.className=e.className?e.className+" "+o:o)},remove:function(e,o){this.has(e,o)&&(e.className=e.className.replace(new RegExp(" ?"+o),""))}},numRollersLeft:function(){var e,o=0;for(var t in PS.map)PS.map.hasOwnProperty(t)&&(e=PS.map[t],!e.scan("hidden")&&e.scan("position_roller")&&o++);return o},nearElement:function(e,o,t){var n=PS.pos.offset(e),i=PS.dims.node(e,!0);return o(n.left,n.top,i.w,i.h,t.w,t.h)},initiatePop:function(e,o){var t,n,i,r;t=document.createElement("div"),t.setAttribute("data-pop-id",o.toString()),PS.css_class.add(t,"popscript-display-none"),t.id="popscript-box-"+o,e="function"==typeof e?e(o):e;var s=typeof e;return-1!==["string","number"].indexOf(s)?t.innerHTML=e:t.appendChild(e),document.body.appendChild(t),r=document.createElement("span"),PS.css_class.add(r,"popscript-display-none"),r.id="popscript-cross-"+o,t.appendChild(r),n=PS.dims.cover(),PS.css_class.add(n,"popscript-display-none"),n.id="popscript-cover-"+o,document.body.appendChild(n),i=PS.dims.cover(),PS.css_class.add(i,"popscript-display-none"),i.id="popscript-roller-"+o,document.body.appendChild(i),[t,n,i,r]},constructPop:function(e,o,t,n,i,r){o.cssText="",t.cssText="",n.cssText="",i.cssText="";var s=e.pop_id;r||PS.animateIn(e,o,t),e.scan("cover")?(t.className="popscript-cover "+e.scan("style_class_cover"),e.scan("style_inline_cover")&&(t.style.cssText+=e.scan("style_inline_cover")),t.style.zIndex=e.scan("position_z")(),PS.css_class.remove(t,"popscript-display-none")):PS.css_class.add(t,"popscript-display-none"),i.innerHTML="",e.scan("cross")?(i.className="popscript-cross  popscript-out "+e.scan("style_class_cross"),e.scan("style_inline_cross")&&(i.style.cssText+=e.scan("style_inline_cross")),i.appendChild(document.createTextNode(e.scan("cross_content"))),i.style.display="inline"):PS.css_class.add(i,"popscript-display-none"),PS.css_class.remove(o,"popscript-display-none"),o.className="popscript-box "+e.scan("style_class_box"),o.style.zIndex=e.scan("position_z")(),e.scan("style_inline_box")&&(o.style.cssText+=e.scan("style_inline_box")),PS.css_class.remove(o,"popscript-drag"),PS.event.remove(o,"mousedown",PS.drag.start),PS.event.remove(o,"mouseup",PS.drag.done),e.scan("full_draggable")&&PS.css_class.add(o,"popscript-drag"),PS.css_class.remove(o,"popscript-close"),PS.css_class.remove(o,"popscript-hide"),PS.event.remove(o,"click",popClose),PS.event.remove(o,"click",popHide),e.scan("click_me_out")&&PS.css_class.add(o,"popscript-"+e.scan("out")),o.parentNode.removeChild(o),e.scan("position_roller")?(n.className="popscript-roller",n.style.zIndex=e.scan("position_z")(),n.innerHTML="",n.appendChild(o),PS.cover_fix.fix(),PS.css_class.remove(n,"popscript-display-none")):(PS.css_class.add(n,"popscript-display-none"),document.body.appendChild(o));var a=PS.css_class.nodes("popscript-drag",o);for(u=0;u<a.length;u++)PS.event.add(a[u],"mousedown",PS.drag.start),PS.event.add(a[u],"mouseup",PS.drag.done);var p=PS.css_class.nodes("popscript-close",o);for(u=0;u<p.length;u++)PS.event.add(p[u],"click",popClose);var c=PS.css_class.nodes("popscript-out",o);for(u=0;u<c.length;u++)PS.event.add(c[u],"click",popOut);var l=PS.css_class.nodes("popscript-hide",o);for(u=0;u<l.length;u++)PS.event.add(l[u],"click",popHide);var d=e.scan("position_check");if(e.compiled.timeouts)for(var u=0;u<e.compiled.timeouts.length;u++)clearTimeout(e.compiled.timeouts[u]);if(e.compiled.intervals)for(var u=0;u<e.compiled.intervals.length;u++)clearTimeout(e.compiled.intervals[u]);if(e.compiled.timeouts=[],e.compiled.intervals=[],d){for(var f=d[0],u=0;u<f.length;u++)e.compiled.timeouts.push(setTimeout(function(){PS.pos.check(s)},f[u]));var m=d[1];for(u=0;u<m.length;u++)e.compiled.intervals.push(setInterval(function(){PS.pos.check(s)},m[u]))}PS.blurNoPropagate(e),PS.pos.check(s,o,t,n)},blurNoPropagate:function(e){var o=e.compiled.blur;e.compiled.blur=!1,setTimeout(function(){e.compiled.blur=o},500)},binder_wait:function(e){e=e||window.event;for(var o=parseInt(this.getAttribute("data-pop-bind-id")),t=PS.bind_map[o].ev2pn[e.type],n=PS.bind_map[o][t],i=0;i<n.in_events.length;i++)PS.event.remove(this,n.in_events[i],PS.binder_wait);pop([this,n.in_events,n.out_events,t],n.content,n.pop_class,n.inline_popscript)},binder_done:function(e){e=e||window.event;var o=parseInt(this.getAttribute("data-pop-bind-id")),t=PS.bind_map[o].ev2pn[e.type];popClose(t)},total:function(){return PS.css_class.nodes("popscript-box").length},exists:function(e){return void 0!==PS.map[e]},hidden:function(e){var o=PS.map[e];return o?o.scan("hidden"):void 0},hasClass:function(e,o){var t=PS.map[e];return t&&-1!==t.pop_class.split(/ +/).indexOf(o)},changeClass:function(e,o,t){o="basic "+o;var n=PS.map[e];return pop?(n.changeClass(o),PS.helper.changeTransition(n,e,t),void 0):PS.popError(4,"Unknown Pop with pop id "+e)},changeProperty:function(e,o,t,n){var i=PS.map[e];return pop?(i.changeProperty(o,t),PS.helper.changeTransition(i,e,n),void 0):PS.popError(4,"Unknown Pop with pop id "+e)},inline:function(e,o,t){var n=PS.map[e];return pop?(n.inline(o),PS.helper.changeTransition(n,e,t),void 0):PS.popError(4,"Unknown Pop with pop id "+e)}};Pop.prototype.changeClass=function(e){this.pop_class=e,this.pop_class_list=PS.checkValidPopClasses(this.pop_class),this.compileClasses()},Pop.prototype.inline=function(e){if(e){PS.compilePopClass(e,this.compiled);for(var o in e)e.hasOwnProperty(o)&&(this.inline_popscript[o]=e[o])}},Pop.prototype.isValid=function(){return this.pop_class_list},Pop.prototype.changeProperty=function(e,o){var t=e instanceof Array?PS.helper.sliceArray(e,0,e.length-1):[];e=e instanceof Array?e[e.length-1]:e,PS.registerPopProperty(this.compiled,e,o,t)},Pop.prototype.compileClasses=function(){this.compiled={};for(var e,o,t=0;t<this.pop_class_list.length;t++){e=PS.compiled_popscript[this.pop_class_list[t]];for(o in e)e.hasOwnProperty(o)&&(this.compiled[o]=e[o])}},Pop.prototype.scan=function(e){return e=e.toLowerCase(),void 0===this.compiled[e]?PS.defaults[e]:this.compiled[e]},PS.all_properties={animation_in_box:PS.convert.ani,animation_in_cover:PS.convert.ani,animation_in_duration:PS.convert.n,animation_out_box:PS.convert.ani,animation_out_cover:PS.convert.ani,animation_out_duration:PS.convert.n,style_class_box:PS.convert.n,style_class_cross:PS.convert.n,style_class_cover:PS.convert.n,style_inline_box:PS.convert.n,style_inline_cross:PS.convert.n,style_inline_cover:PS.convert.n,position_fixed:PS.convert.bool,position_x:PS.convert.boxPosition,position_y:PS.convert.boxPosition,position_z:PS.convert.z,position_x_scrolled:PS.convert.bool,position_y_scrolled:PS.convert.bool,position_x_scroll:PS.convert.bool,position_y_scroll:PS.convert.bool,position_check:PS.convert.positionCheck,position_roller:PS.convert.bool,full_draggable:PS.convert.bool,cover:PS.convert.bool,esc:PS.convert.bool,blur:PS.convert.bool,cross:PS.convert.bool,click_me_out:PS.convert.bool,cross_content:PS.convert.n,out:PS.convert.hideOrClose,beforepopout:PS.convert.n,afterpopout:PS.convert.loff,nearelement:PS.convert.n,beforepopin:PS.convert.n},Array.indexOf||(Array.prototype.indexOf=function(e){for(var o=0;o<this.length;o++)if(this[o]==e)return o;return-1});var PopScript=PS;initiatePopScript();